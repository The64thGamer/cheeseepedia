{{- /*
Partial: site_search.html
Usage:
{{ partial "site_search.html" . }}

Notes:
- Loads search JSON data from /data/*.json via fetch.
- Unified search bar: tags that match go into tag chips, non-matching terms become fuzzy search chips
*/ -}}

{{- $tagStyles := site.Data.tag_styles -}}
{{- $tagCounts := site.Data.tags.tag_counts -}}
{{- $isTheoryweb := hasPrefix .RelPermalink "/theoryweb" -}}

<div class="search-ui-container">
  <div class="search-controls">
    <div class="search-tags-wrapper">
      <div id="tag-chip-container" class="tag-chip-container" tabindex="0">
        <input id="tag-input" class="tag-input" placeholder="Search. . ." autocomplete="off" />
      </div>
      <div id="tag-suggestions" class="tag-suggestions" aria-hidden="true"></div>
    </div>

<div class="search-collapsible" id="search-collapsible">
  <div class="search-layout">
    <!-- Quick Tags panel that can be positioned above or to the left -->
    <div class="quick-tags-panel" id="quick-tags-panel">
      <div class="predef-list">
        {{- $predef := "" -}}
        {{- if $isTheoryweb -}}
        {{- $predef = slice
        "Five Nights at Freddy's (Game)"
        "2014"
        "2026"
        -}}
        {{- else -}}
        {{- $predef = slice
        "Pizza Time Theatre"
        "ShowBiz Pizza Place"
        "Chuck E. Cheese's"
        "2026"
        "1977"
        "Locations"
        "Showtapes"
        "Animatronic Shows"
        "Stage Variations"
        "Animatronics"
        "Animatronic Parts"
        "Animatronic Preservation"
        "Costumed Characters"
        "Retrofits"
        "History"
        "Cancelled Locations"
        "Remodels and Initiatives"
        "Arcades and Attractions"
        "Store Fixtures"
        "Companies/Brands"
        "Characters"
        "Events"
        "Animatronic Control Systems"
        "Other Systems"
        "Simulators"
        "Programming Systems"
        "Commercials"
        "News Footage"
        "Company Media"
        "Movies"
        "Puppets"
        "Live Shows"
        "ShowBiz Pizza Programs"
        "Showtape Formats"
        "Family Vision"
        "Corporate Documents"
        "Documents"
        "Promotional Material"
        "Social Media and Websites"
        "Ad Vehicles"
        "In-Store Merchandise"
        "Products"
        "Menu Items"
        "Tickets"
        "Tokens"
        "Employee Wear"
        "Video Games"
        "Sally Corporation"
        "Jim Henson's Creature Shop"
        "Walt Disney Imagineering"
        "Five Nights at Freddy's"
        "Transcriptions"
        "Unknown Year"
        "User"
        "Meta"
        -}}
        {{- end -}}
        
        <div class="predef-tags">
          <h4>Quick Tags</h4>
          <div class="predef-scroll">
            <div class="predef-list">
              {{- range $i, $t := $predef -}}
                {{- $entry := index $tagStyles $t -}}
                {{- $emoji := "" -}}
                {{- $color := "" -}}
                {{- if $entry -}}
                  {{- with $entry }}
                    {{- $emoji = .emoji -}}
                    {{- $color = .color -}}
                  {{- end -}}
                {{- end -}}
                {{- $count := index $tagCounts $t -}}
                <button
                  class="predef-tag-btn"
                  type="button"
                  data-tag="{{ $t | html }}"
                  title="Add tag"
                  {{- if $color }}style="--tag-bg: {{ $color }};"{{- end -}}
                >
                  {{- if $emoji }}{{ $emoji | safeHTML }} {{- end -}}
                  {{- $t -}}
                  {{- with $count -}} <span class="tag-count">({{ . }})</span>{{- end -}}
                </button>
              {{- end -}}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tabs" id="results-tabs" hidden>
      <!-- Controls inserted above the tabs -->
      <div class="result-controls" style="margin-bottom:8px;">
        <label>
          Show:
          <select id="results-per-section" title="Results per section">
            <option value="10" selected>10</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="all">All</option>
          </select>
        </label>

        <label style="margin-left:10px;">
          Sort Articles:
          <select id="articles-sort" title="Sort articles">
            <option value="relevancy" selected>Relevancy</option>
            <option value="oldest">Oldest → Newest</option>
            <option value="newest">Newest → Oldest</option>
          </select>
        </label>
        
        <label style="margin-left:10px;">
          <input type="checkbox" id="keep-tags-visible" />
          Show Quick Tags
        </label>
      </div>

      <div class="tab-buttons">
        {{- if $isTheoryweb -}}
        <button class="tab-button active" data-tab="tab-theories">Theories</button>
        <button class="tab-button" data-tab="tab-images">Images</button>
        <button class="tab-button" data-tab="tab-animations">Animations</button>
        <button class="tab-button" data-tab="tab-sounds">Sounds</button>
        <button class="tab-button" data-tab="tab-videos">Videos</button>
        <button class="tab-button" data-tab="tab-gameplay">Gameplay</button>
        {{- else -}}
        <button class="tab-button active" data-tab="tab-articles">Articles</button>
        <button class="tab-button" data-tab="tab-photos">Photos</button>
        <button class="tab-button" data-tab="tab-videos">Videos</button>
        <button class="tab-button" data-tab="tab-reviews">Reviews</button>
        {{- end -}}
      </div>

      <div class="tab-content">
        {{- if $isTheoryweb -}}
        <div class="tab-panel active" id="tab-theories">
          <div class="results-list" id="list-theories"></div>
        </div>
        <div class="tab-panel" id="tab-images">
          <div class="results-list" id="list-images"></div>
        </div>
        <div class="tab-panel" id="tab-animations">
          <div class="results-list" id="list-animations"></div>
        </div>
        <div class="tab-panel" id="tab-sounds">
          <div class="results-list" id="list-sounds"></div>
        </div>
        <div class="tab-panel" id="tab-videos">
          <div class="results-list" id="list-videos"></div>
        </div>
        <div class="tab-panel" id="tab-gameplay">
          <div class="results-list" id="list-gameplay"></div>
        </div>
        {{- else -}}
        <div class="tab-panel active" id="tab-articles">
          <div class="results-summary" aria-live="polite"></div>
          <div class="results-list" id="list-articles"></div>
        </div>
        <div class="tab-panel" id="tab-photos">
          <div class="results-list" id="list-photos"></div>
        </div>
        <div class="tab-panel" id="tab-videos">
          <div class="results-list" id="list-videos"></div>
        </div>
        <div class="tab-panel" id="tab-reviews">
          <div class="results-list" id="list-reviews"></div>
        </div>
        {{- end -}}
      </div>
    </div>
  </div>
</div>
  </div>
</div>
<script>
  window.SEARCH_CONFIG = {
    searchBase: {{- if $isTheoryweb }}"/data/search/theoryweb"{{ else }}"/data/search"{{ end }},
    tagsBase:   {{- if $isTheoryweb }}"/data/tags/theoryweb"{{ else }}"/data/tags"{{ end }}
  };
</script>
<script src="/js/search.js"></script>