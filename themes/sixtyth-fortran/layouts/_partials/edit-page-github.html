<center>Hello user! The wiki is attempting to move away from the awful DecapCMS to an in-page editor. Not every part of a page will be editable during this transition- use Decap or Github for what's missing, but hopefully what's here is a better experience!</center>
<br>
<div id="edit-page-content">
  <!-- GitHub Token Input -->
  <div id="github-auth-section">
    <input type="password" id="edit-github-token" placeholder="GitHub Personal Access Token (Classic)" autocomplete="new-password">
      <h2>How to create a token?</h2>
      <ol>
        <li>If you do not already have a GitHub account, you'll need to <a href="https://github.com/signup" target="_blank">make one</a> to edit pages.</li>
        <li>Go to <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings â†’ Tokens (classic)</a></li>
        <li>Click "Generate new token (classic)"</li>
        <li>Select the <strong>repo</strong> scope</li>
        <li>Generate and copy the token.</li>
        <li>Paste above ^. Your browser should let you save it as a password. This wiki does not save or keep tokens.</li>
      </ol>
    <button id="auth-and-load">Load Editor</button>
  </div>

  <!-- Editor Section -->
  <div id="editor-section" style="display: none;">
    <div id="custom-toolbar">
      <button id="insert-wikilink" class="toolbar-btn">Link to Page</button>
      <button id="insert-citation" class="toolbar-btn">Citation</button>
    </div>
    <div id="editor"></div>
    <div id="editor-actions">
      <button id="save-changes-btn">Save Changes & Create PR</button>
      <button id="cancel-edit-btn">Cancel</button>
    </div>
      <h2>Other Actions</h2>
  <div id="editor-actions">
    <button id="add-to-gallery-btn">Add Photos to Gallery</button>
    <button id="write-review-btn">Write a Review</button>
  </div>
  </div>



  <!-- ===================== REVIEW MODAL ===================== -->
  <div id="review-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close-review">&times;</span>

      <!-- Step 1: Review form -->
      <div id="review-step-1" class="step">
        <h3>Write a Review</h3>

        <label style="display:block; margin-bottom:8px;">Do you recommend this?</label>
        <div style="display:flex; gap:12px; margin-bottom:16px;">
          <label><input type="radio" name="review-recommend" value="true"> &#128077; Yes</label>
          <label><input type="radio" name="review-recommend" value="false"> &#128078; No</label>
        </div>

        <label for="review-title" style="display:block; margin-bottom:4px;">Review Title</label>
        <input type="text" id="review-title" placeholder="e.g. A fun showtape!" autocomplete="off" style="width:100%; margin-bottom:12px;">

        <label for="review-body" style="display:block; margin-bottom:4px;">Your Review</label>
        <textarea id="review-body" placeholder="Write your review here..." rows="8" autocomplete="off" style="width:100%;"></textarea>

        <p id="review-author-note" style="margin-top:14px; font-size:0.9em; color:#aaa;"></p>

        <div style="margin-top:10px;">
          <button id="review-submit">Submit Review</button>
        </div>
      </div>

      <!-- Step 2: Progress / success / error -->
      <div id="review-step-2" class="step" style="display:none;">
        <h3>Submitting Review...</h3>
        <div id="review-progress">
          <div class="progress-item"><span id="review-prog-1">&#8987;</span> Validating token...</div>
          <div class="progress-item"><span id="review-prog-2">&#8987;</span> Setting up fork...</div>
          <div class="progress-item"><span id="review-prog-3">&#8987;</span> Creating branch...</div>
          <div class="progress-item"><span id="review-prog-4">&#8987;</span> Writing review file...</div>
          <div class="progress-item"><span id="review-prog-5">&#8987;</span> Creating PR...</div>
        </div>
        <div id="review-success" style="display:none;">
          <h4 style="color: var(--yellow);">&#9989; Review Submitted!</h4>
          <a id="review-pr-link" href="#" target="_blank" class="github-link">View Pull Request on GitHub</a>
          <br><br>
          <button id="review-done">Done</button>
        </div>
        <div id="review-error" style="display:none; color: var(--orange);">
          <h4>&#10060; Error</h4>
          <p id="review-error-msg"></p>
          <button id="review-retry">Try Again</button>
        </div>
      </div>

    </div>
  </div>

  <!-- ===================== GALLERY MODAL ===================== -->
  <div id="gallery-upload-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close-gallery">&times;</span>

      <div id="gallery-step-2" class="step">
        <h3>Select Images</h3>
        <input type="file" id="gallery-image-files" accept=".avif" multiple>
        Only .avif files accepted
        <button id="gallery-next-2">Next</button>
      </div>

      <div id="gallery-step-3" class="step" style="display: none;">
        <h3>Image Description</h3>
        <textarea id="gallery-description" placeholder="Enter description" rows="4" autocomplete="off"></textarea>
        <button id="gallery-back-2">Back</button>
        <button id="gallery-next-3">Next</button>
      </div>

      <div id="gallery-step-4" class="step" style="display: none;">
        <h3>Date Photographed</h3>
        <div class="date-inputs">
          <select id="gallery-year" autocomplete="off"><option value="">Year</option></select>
          <select id="gallery-month" autocomplete="off">
            <option value="">Month</option>
            <option value="01">January</option><option value="02">February</option>
            <option value="03">March</option><option value="04">April</option>
            <option value="05">May</option><option value="06">June</option>
            <option value="07">July</option><option value="08">August</option>
            <option value="09">September</option><option value="10">October</option>
            <option value="11">November</option><option value="12">December</option>
          </select>
          <select id="gallery-day" autocomplete="off"><option value="">Day</option></select>
        </div>
        <button id="gallery-back-3">Back</button>
        <button id="gallery-next-4">Next</button>
      </div>

      <div id="gallery-step-5" class="step" style="display: none;">
        <h3>Creating Pull Request...</h3>
        <div id="gallery-progress">
          <div class="progress-item"><span id="gallery-prog-1">&#8987;</span> Validating...</div>
          <div class="progress-item"><span id="gallery-prog-2">&#8987;</span> Setting up fork...</div>
          <div class="progress-item"><span id="gallery-prog-3">&#8987;</span> Uploading images...</div>
          <div class="progress-item"><span id="gallery-prog-4">&#8987;</span> Creating files...</div>
          <div class="progress-item"><span id="gallery-prog-5">&#8987;</span> Committing...</div>
          <div class="progress-item"><span id="gallery-prog-6">&#8987;</span> Creating PR...</div>
        </div>
        <div id="gallery-success" style="display: none;">
          <h4 style="color: var(--yellow);">&#9989; Success!</h4>
          <a id="gallery-pr-link" href="#" target="_blank" class="github-link">View Pull Request</a>
          <br><br>
          <button id="gallery-done">Done</button>
        </div>
        <div id="gallery-error" style="display: none; color: var(--orange);">
          <h4>&#10060; Error</h4>
          <p id="gallery-error-msg"></p>
          <button id="gallery-retry">Try Again</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== SAVE PROGRESS MODAL ===================== -->
  <div id="save-progress-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Saving Changes...</h3>
      <div id="save-progress">
        <div class="progress-item"><span id="save-progress-1">&#8987;</span> Validating token...</div>
        <div class="progress-item"><span id="save-progress-2">&#8987;</span> Setting up fork...</div>
        <div class="progress-item"><span id="save-progress-3">&#8987;</span> Creating branch...</div>
        <div class="progress-item"><span id="save-progress-4">&#8987;</span> Updating file...</div>
        <div class="progress-item"><span id="save-progress-5">&#8987;</span> Creating pull request...</div>
      </div>
      <div id="save-success" style="display: none;">
        <h4 style="color: var(--yellow);">&#9989; Pull Request Created!</h4>
        <a id="save-pr-link" href="#" target="_blank" class="github-link">View Pull Request on GitHub</a>
        <br><br>
        <button id="close-save-modal">Done</button>
      </div>
      <div id="save-error" style="display: none; color: var(--orange);">
        <h4>&#10060; Error</h4>
        <p id="save-error-message"></p>
        <button id="retry-save">Try Again</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast UI Editor CSS -->
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor-dark.min.css" />
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

<script type="module">
import { Octokit } from 'https://cdn.skypack.dev/@octokit/rest';
window.OctokitClass = Octokit;
window.editorLibsReady = true;
  window.EDITOR_CONFIG = {
    pageTitle:      {{ .Title | jsonify }},
    pageCategories: {{ .Params.categories | jsonify }}
  };
</script>
