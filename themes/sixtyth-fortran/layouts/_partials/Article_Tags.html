{{- $tagStyles := site.Data.tag_styles -}}
{{- $isTheoryweb := eq .Section "theoryweb" -}}
{{- $tagCounts := cond $isTheoryweb site.Data.tags.theoryweb.tag_counts site.Data.tags.tag_counts -}}
{{- $tagsByPage := cond $isTheoryweb site.Data.tags.theoryweb.tags_by_page site.Data.tags.tags_by_page -}}

{{- $filePath := .File.Path -}}
{{- $key := $filePath | lower -}}
{{- $key = replace $key "content/" "" -}}
{{- $key = replace $key ".md" "" -}}
{{- $key = strings.TrimPrefix "/" $key -}}
{{- $key = replaceRE `[^a-z0-9/]+` "-" $key -}}
{{- $key = replaceRE `-{2,}` "-" $key -}}
{{- $key = strings.TrimSuffix "-" $key -}}
{{- $tags := index $tagsByPage $key -}}
{{- if $tags -}}
<div class="predef-tags page-quick-tags">
<h3>Related Tags</h3>
<div class="predef-scroll">
<div class="predef-list">
{{- range $tags -}}
{{- $tag := printf "%v" . -}}
{{- $entry := index $tagStyles $tag -}}
{{- $count := index $tagCounts $tag -}}
<button
  class="predef-tag-btn"
  type="button"
  data-tag="{{ $tag | html }}"
  title="Add tag"
  {{- with $entry }}
  {{- if .color }}style="--tag-bg: {{ .color }};"{{- end -}}
  {{- end -}}
>
  {{- with $entry }}
  {{- if .emoji }}{{ .emoji | safeHTML }} {{- end -}}
  {{- end -}}
  {{- $tag -}}
  {{- with $count }}
  <span class="tag-count">({{ . }})</span>
  {{- end -}}
</button>
{{- end -}}
</div>
</div>
</div>
{{- end -}}