<button id="settingsButton" class="settings-button" aria-label="Settings"><img src="/UI/Emojis/control_knobs.svg" style="margin-right:0rem; width:1.75rem" class="emoji"></button>

<div id="settingsModal" class="settings-modal">
  <div class="settings-modal-content">
    <div class="settings-modal-header">
      <h2>Settings</h2>
      <button class="settings-modal-close" id="closeSettings">&times;</button>
    </div>
    
    <div class="settings-modal-body">
      <div class="setting-group">
        <label for="colorThemeSelector">Color Theme</label>
        <select id="colorThemeSelector">
          <option value="standard">Standard</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
          <option value="classic">Classic</option>
          <option value="showbiz">ShowBiz</option>
          <option value="fnaf">FNaF</option>
          <option value="pasqually">Italy</option>
          <option value="halloween">Halloween</option>
          <option value="pride">Pride</option>
          <option value="winter">Winter</option>
          <option value="anniversary">Anniversary</option>
        </select>
      </div>

      <div class="setting-group">
        <label for="eventThemeSelector">Seasonal Themes</label>
        <select id="eventThemeSelector">
          <option value="auto">Auto (Date-Based)</option>
          <option value="off">Off</option>
        </select>
      </div>

      <div class="setting-group">
        <label for="pageWidthSelector">Page Width</label>
        <select id="pageWidthSelector">
          <option value="default">Default</option>
          <option value="wide">Wide</option>
        </select>
      </div>
    </div>

    <div class="settings-modal-footer">
      All settings are stored locally on your device and are not shared.
    </div>
  </div>
</div>

<script>
const logoMap = {
  "standard": "/UI/CEPLogo.png",
  "dark": "/UI/LogoDark.png",
  "light": "/UI/LogoLight.png",
  "classic": "/UI/LogoClassic.png",
  "showbiz": "/UI/LogoShowBiz.png",
  "fnaf": "/UI/LogoFNaF.png",
  "anniversary": "/UI/LogoAnniversary.png",
  "halloween": "/UI/LogoHalloween.png",
  "pride": "/UI/LogoPride.png",
  "winter": "/UI/LogoWinter.png",
  "pasqually": "/UI/LogoPasqually.png"
};

function updateLogo(theme) {
  const logo = document.getElementById("mainLogo");
  if (logo && logoMap[theme]) {
    logo.src = logoMap[theme];
  }
}

function updateSnow(theme) {
  const snowContainer = document.getElementById("snow_wrap");
  if (!snowContainer) return;
  snowContainer.style.display = (theme === "winter") ? "block" : "none";
}

function updateFnaf(theme) {
  const fnafContainer = document.getElementById("fnaf_wrap");
  if (!fnafContainer) return;
  fnafContainer.style.display = (theme === "fnaf") ? "block" : "none";
}

function applyTheme(theme) {
  const root = document.documentElement;
  if (theme === "standard") {
    root.removeAttribute("data-theme");
  } else {
    root.setAttribute("data-theme", theme);
  }
  updateLogo(theme);
  updateSnow(theme);
  updateFnaf(theme);
}

function applyPageWidth(width) {
  const root = document.documentElement;
  if (width === "default") {
    root.removeAttribute("data-width");
  } else {
    root.setAttribute("data-width", width);
  }
}

function applyDateBasedTheme() {
  const today = new Date();
  const month = today.getMonth() + 1;
  const date = today.getDate();

  if (month === 10) return "halloween";
  if (month === 6 || month === 7) return "pride";
  if (month === 5 && date === 17) return "anniversary";
  if (month === 12) return "winter";

  return null;
}

function determineActiveTheme() {
  const selectedTheme = document.getElementById('colorThemeSelector').value;
  const eventSelection = document.getElementById('eventThemeSelector').value;
  
  let themeToApply = selectedTheme;
  
  if (eventSelection === "auto") {
    const seasonalTheme = applyDateBasedTheme();
    if (seasonalTheme) themeToApply = seasonalTheme;
  }
  
  return themeToApply;
}

// Settings modal
const settingsButton = document.getElementById('settingsButton');
const settingsModal = document.getElementById('settingsModal');
const closeSettings = document.getElementById('closeSettings');

settingsButton.addEventListener('click', () => {
  settingsModal.style.display = 'flex';
});

closeSettings.addEventListener('click', () => {
  settingsModal.style.display = 'none';
});

// Close modal when clicking outside
settingsModal.addEventListener('click', (e) => {
  if (e.target === settingsModal) {
    settingsModal.style.display = 'none';
  }
});

// Close with Escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && settingsModal.style.display === 'flex') {
    settingsModal.style.display = 'none';
  }
});

// Color theme selector
document.getElementById('colorThemeSelector').addEventListener('change', function () {
  const themeToApply = determineActiveTheme();
  applyTheme(themeToApply);
  localStorage.setItem('selectedColorTheme', this.value);
});

// Event selector
document.getElementById('eventThemeSelector').addEventListener('change', function () {
  const themeToApply = determineActiveTheme();
  applyTheme(themeToApply);
  localStorage.setItem('eventThemeSetting', this.value);
});

// Page width selector
document.getElementById('pageWidthSelector').addEventListener('change', function () {
  applyPageWidth(this.value);
  localStorage.setItem('pageWidth', this.value);
});

// Initial load
window.addEventListener('DOMContentLoaded', () => {
  const savedTheme = localStorage.getItem('selectedColorTheme') || "standard";
  const savedEvent = localStorage.getItem('eventThemeSetting') || "auto";
  const savedWidth = localStorage.getItem('pageWidth') || "default";

  document.getElementById('colorThemeSelector').value = savedTheme;
  document.getElementById('eventThemeSelector').value = savedEvent;
  document.getElementById('pageWidthSelector').value = savedWidth;

  const themeToApply = determineActiveTheme();
  applyTheme(themeToApply);
  applyPageWidth(savedWidth);
});
</script>