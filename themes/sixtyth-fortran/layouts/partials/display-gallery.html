{{- /* layouts/partials/gallery.html
     Renders a gallery for the current page (a wiki article) by looking up photos.
*/ -}}

{{- $photos := partialCached "get-photos-by-page.html" . "photo-index-v1" -}}
{{- if gt (len $photos) 0 -}}
  {{- /* Optionally dedupe again, just in case */ -}}
  {{- $uniq := slice -}}
  {{- range $p := $photos -}}
    {{- $exists := where $uniq "RelPermalink" $p.RelPermalink -}}
    {{- if eq (len $exists) 0 -}}
      {{- $uniq = $uniq | append $p -}}
    {{- end -}}
  {{- end -}}

  {{- /* Sort by date (if you have a date param) */ -}}
  {{- $sorted := sort $uniq ".Params.startDate" -}}

  <div class="gallery">
    {{- range $p := $sorted -}}
      {{- /* Use your DisplayPhoto partial */ -}}
      {{- partialCached "DisplayPhoto.html" (dict "name" $p.Title "mode" "no-css-file-link") (printf "DisplayPhoto|%s" $p.Title) -}}
    {{- end -}}
  </div>
{{- end -}}
