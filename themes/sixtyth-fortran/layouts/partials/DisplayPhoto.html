{{- /* layouts/partials/DisplayPhoto.html — data-driven variant
     Params:
       .name  (string)
       .mode  (string)
     Behavior:
       - Prefer metadata from data/photos-by-page.json (fast).
       - Keeps modes identical to your existing partial.
*/ -}}

{{- $ctxName := (.name | default "") | printf "%s" -}}
{{- $ctxMode := (.mode | default "default") | printf "%s" -}}

{{- /* Build a lightweight meta map keyed by photo name from site.Data if present */ -}}
{{- $metaMap := dict -}}
{{- $dataIdx := index site.Data "photos-by-page" -}}
{{- if $dataIdx -}}
  {{- range $pageKey, $arr := $dataIdx -}}
    {{- range $i, $m := $arr -}}
      {{- $n := index $m "name" | default "" -}}
      {{- if ne $n "" -}}
        {{- /* store minimal meta fields we care about */ -}}
        {{- $metaMap = merge $metaMap (dict $n (dict "imageURL" (index $m "imageURL") "hasFile" (index $m "hasFile") "fileName" (index $m "fileName") "startDate" (index $m "startDate"))) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- /* Lookup meta; defaults */ -}}
{{- $imgURL := "/UI/File Not Found.jpg" -}}
{{- $hasFile := false -}}
{{- if ne $ctxName "" -}}
  {{- $m := index $metaMap $ctxName -}}
  {{- if $m -}}
    {{- $imgURL = (index $m "imageURL") | default $imgURL -}}
    {{- $hasFile = (index $m "hasFile") | default false -}}
  {{- else -}}
    {{- /* Fallback path — attempt static/photos/<name> */ -}}
    {{- $imgURL = printf "/photos/%s" $ctxName -}}
  {{- end -}}
{{- end -}}

{{- /* alt text */ -}}
{{- $alt := $ctxName -}}
{{- if eq $ctxName "" -}} {{- $alt = "File Not Found" -}} {{- end -}}

{{- /* Decide canonical link URL (no page objects here) */ -}}
{{- $linkURL := "#" -}}
{{- if $hasFile -}}
  {{- $linkURL = $imgURL -}}
{{- end -}}

{{- /* === Render according to mode (keeps your markup) === */ -}}
{{- if eq $ctxMode "default" -}}
  <div class="article-photo-image">
    <a href="{{ $linkURL }}">
      <img src="{{ $imgURL }}" alt="{{ $alt }}" data-pagefind-meta="image[src], image_alt[alt]" />
    </a>
  </div>
  <div class="article-photo-description">
    {{- /* No page Content available in data-driven mode, keep photo name as description */ -}}
    {{- if ne $ctxName "" -}}
      {{- $clean := replace $ctxName "_" " " | replaceRE "\\.(?i)(avif|jpg|jpeg|png|gif|webp)$" "" -}}
      {{- $clean -}}
    {{- else -}}
      File Not Found
    {{- end -}}
  </div>

{{- else if eq $ctxMode "no-css-file-link" -}}
  <a href="{{ $linkURL }}">
    <img data-pagefind-meta="image[src], image_alt[alt]" src="{{ $imgURL }}" alt="{{ $alt }}" />
  </a>
  <div class="article-photo-description">
    {{- if ne $ctxName "" -}}{{ $ctxName }}{{- else -}}File Not Found{{- end -}}
  </div>

{{- else if eq $ctxMode "no-css-no-desc" -}}
  <a href="{{ $linkURL }}">
    <img data-pagefind-meta="image[src], image_alt[alt]" src="{{ $imgURL }}" alt="{{ $alt }}" />
  </a>

{{- else if eq $ctxMode "no-css" -}}
  <a href="{{ $linkURL }}">
    <img data-pagefind-meta="image[src], image_alt[alt]" src="{{ $imgURL }}" alt="{{ $alt }}" />
  </a>
  <div class="article-photo-description">
    {{- if ne $ctxName "" -}}{{ $ctxName }}{{- else -}}File Not Found{{- end -}}
  </div>

{{- else if eq $ctxMode "no-link" -}}
  <img src="{{ $imgURL }}" alt="{{ $alt }}" data-pagefind-meta="image[src], image_alt[alt]" />

{{- else -}}
  <div class="article-photo-image">
    <a href="{{ $linkURL }}">
      <img src="{{ $imgURL }}" alt="{{ $alt }}" data-pagefind-meta="image[src], image_alt[alt]" />
    </a>
  </div>
  <div class="article-photo-description">
    {{- if ne $ctxName "" -}}{{ $ctxName }}{{- else -}}File Not Found{{- end -}}
  </div>
{{- end -}}
